---
title: "ErrTraffic"
classes: wide
header:
  teaser: /assets/images/ErrTraffic/logo.jpg
ribbon: black
description: "Exploring vulnerabilties in the ErrTraffic panel"
categories:
  - Threat Research
tags:
  - Threat Research
toc: true
---

# ErrTraffic

Inspired by Censys' blog [ErrTraffic: Inside a GlitchFix Attack Panel](https://censys.com/blog/errtraffic-inside-glitchfix-attack-panel), we wanted to take a poke at the source-code and find weaknesses. 

We always approach threat research with an attacker mindset. In this blog, we'll walk through these discoveries and explain our process of recovering and analysing the source code, deploying locally, identifying vulnerabilities, and developing simple POCs to pwn ErrTraffic. 

## Background

## Vulnerabilities Overview

During our investigation into ErrTraffic we discovered an authenticated file upload vulnerability that could be leveraged to upload a webshell and gain Remote Code Execution (RCE). In later versions we discovered the developers had patched this vulnerability. 

Although the RCE we discovered requires authentiation, in some versions of ErrTraffic, it is possible to bypass authentication completely. 

By default, if a `install.php` source file isn't manually deleted, ErrTraffic will allows itself to be reinstalled with a new configuration. We can install a "rouge" MySQL server that we control. 

If we can host the database for "ErrTraffic" server ourselves, we can set our own credentials and bypass authentication, potentially leading to an authenticated RCE if an older version is being used.  

Furthermore, we discovered that if we host the MySQL database ourselves, we can modify the hard-coded file paths where malware is hosted, leveraging path traversal in order to get Local File Inclusion (LFI). 

# Seizing the source

As unfortunately we cannot attack genuine threat actor infrastrcuture, in order to find vulnerabilities and exploit, we need to get our hands on the source-code and self host. 

We saw Censys' had the source, and it was being advertised on cybercrime forumns, so it must be out there! There are few ways we could approach getting our hands on this. 

1) OSINT
2) Fuzzing

Fuzzing ended up being successful as threat actors are simple and predicatable creatures. 

## Fuzzing

To fuzz ErrTraffic webservers for exposed panels, we first have to find the ErrTraffic web-servers.

Censys provided a query to identify ErrTraffic servers:

```
web.endpoints.http.headers: (key: "Set-Cookie" and value: "errtraffic_session=")
```

Additionally, when you visit an ErrTraffic site, a HTTP request is made to `/admin/styles.css`. We can leverage the hash of the `styles.css` page hunt for additional panels on URLScan:

[![1](/assets/images/err/1.png)](/assets/images/err/1.png){: .full}  

Once we've got a list of "targets", we can use `ffuf` and create wordlist containing common filenames like `panel.zip`, `панель.zip`, `errtraffic.7z`, and many more variations!

Using a quick one-liner we can loop through each "target" and run a `ffuf` command:

`while read -r url; do ffuf -u "http://$url/FUZZ" -w /path/to/wordlist.txt -fc 401,403; done < targets.txt` 


After letting this run we got 1 hit!

[![1](/assets/images/err/2.png)](/assets/images/err/2.png){: .full}  

## Source Code Analysis

Unzipping the sniped panel we can see it contains 

```
.
├── panel
│  ├── admin
│  │  ├── auth.php
│  │  ├── delete_file.php
│  │  ├── index.php
│  │  ├── login.php
│  │  ├── logout.php
│  │  ├── partials
│  │  │  ├── analytics.php
│  │  │  ├── files.php
│  │  │  ├── script.php
│  │  │  └── settings.php
│  │  ├── set_active_file.php
│  │  ├── styles.css
│  │  ├── update_file.php
│  │  ├── update_js.php
│  │  ├── update_password.php
│  │  ├── update_script.php
│  │  ├── update_settings.php
│  │  └── upload_file.php
│  ├── api
│  │  ├── css.js
│  │  ├── css.js.php
│  │  ├── download.php
│  │  ├── generate-download-token.php
│  │  ├── icons
│  │  │  ├── brave.ico
│  │  │  ├── chrome.ico
│  │  │  ├── firefox.ico
│  │  │  ├── opera.ico
│  │  │  └── vivaldi.ico
│  │  └── log.php
│  ├── config
│  │  └── config.php
│  ├── index.php
│  ├── install.php
│  └── uploads
│      ├── android
│      ├── mac
│      └── windows
```

